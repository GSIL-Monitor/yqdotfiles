<!-- This Apple Help template put together by Andy Matuschak
	http://www.andymatuschak.org
	andy@andymatuschak.org
	Version 1.0
	
	Adapted from the Safari help book-thanks, Apple!
	Adapted more directly from Pixen's help book.
	Licensed under MIT. -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/sgml/loosedtd.html">
<html>
	<head>
		<title>Writing AppleScript for Hazel</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="custom tokens, export tokens, abort, retarget" />
		<meta name="description" content="Writing AppleScript for Hazel" />
		<link media="all" rel="stylesheet" href="../css/topicPage.css" />
	</head>
	<body>
		<A NAME="support"></A>
		<A NAME="AppleScript"></A>

		<div id="banner">
			<div id="machelp">
				<a name="rules"></a>
				<!-- Specify a category in the anchor above; then you can
					link to listings of every topic in a given category. -->
				<a class="bread" href="help:anchor='access' bookID=Hazel Help">Hazel Help</a>
				<!-- The above links back to the index page -->
			</div>
			<div id="index">
				<a class="leftborder" href="index.html">Index</a>
			</div>
		</div>
		<div id="mainbox">
			<div id="caticon">
				<img class="icon" src="../gfx/icon.png" alt="Hazel Icon" />
			</div>
			<div id="pagetitle">
				<h1>Writing AppleScript for Hazel</h1>
			</div>
				<p>Hazel can trigger AppleScript from rules via two mechanisms: the "Passes AppleScript" condition and the "Run AppleScript" action. In either case, you can enter a script directly into Hazel or have Hazel trigger an external script.</p>
				<p>Note that if you prefer using JavaScript, you can use that instead. See <a href="writingJavaScript.html">Writing JavaScript</a>.</p>

                
                <br/>
                <h2>Writing an AppleScript for use in a rule condition</h2>
                <p>You can use AppleScripts to have a rule apply your own custom logic to the conditions. Simply have your script return <code>true</code> or <code>false</code> to indicate whether the file passes your script. Keep in mind that since rule conditions are evaluated many times, your script should run fairly quickly otherwise, it may greatly affect rule performance. Also, it is imperative that the script not modify any files or folders underneath the folder Hazel is monitoring.</p>

		<p>You can optionally return a record instead of true/false. This allows you to communicate values back to Hazel. Currently the following keys are recognized:</p>
		<ul>
			<li><b>hazelPassesScript</b>: Same as returning <code>true</code> or <code>false</code> by itself. Indicates to Hazel whether the file passes the script or not.</li>
			<li><b>hazelOutputAttributes</b>: A list of values for the custom attributes that this script exports. The values must be in the order as you specify in the interface. See the section below on <a href="#customtokens">Custom Attributes</a>.</li>
		</ul>
                
                <div id="asindent">
                <h3>For embedded scripts</h3>
                <p>You can enter AppleScript directly into Hazel as an embedded script. Scripts entered in this fashion are saved with your rules. This means that they are carried with your rules when you transfer your rules around (via export/import).</p>
				<p>To show the script editor, click on the "Edit Script" button. Here, you can enter your AppleScript. Note that no handler is needed. You can include the body of your script directly in the editor. The variable <i>theFile</i> carries an alias to the file that Hazel will pass to the script.</p>
                </div>
                
                <div id="asindent">
                <h3>For external scripts</h3>
				<p>Hazel requires that the script contain a handler called <i>hazelMatchFile</i>. The handler takes two arguments which are an alias for the file that matched the rule and a list of input attribute values (see <a href="#customtokens">Input Attributes</a>. Below is a template you can use:</p>
				<div summary="AppleScript Template" id="taskbox">
					<pre>
on hazelMatchFile(theFile, inputAttributes)

	-- Add your logic here.
	-- 'theFile' is an alias to the file that matched.
	-- 'inputAttributes' is an AppleScript list of the values of any attributes you told Hazel to pass in.
	-- Make sure to return true or false (or optionally a record) to indicate whether the file passes this script

end hazelMatchFile
					</pre>
				</div>
                </div>

                <br/>
                <h2>Writing an AppleScript for use in a rule action</h2>
                
                <p>You can use AppleScript to create your own actions to be applied when a rule is executed.</p>
                
				<p>Some notes about writing AppleScripts for the "Run AppleScript" action:</p>
				<ul>
					<li>If you want the script to terminate unsuccessfully, you must throw an error. If an error is encountered, Hazel will consider the rule as a whole to have not run successfully and will try to run the rule again later. If no error is thrown, Hazel will consider the script to have run successfully regardless of what is returned.</li>
                    <a name="returnrecord"></a>
					<li>You can optionally return a record. This allows you to communicate back to Hazel. Currently the following keys are recognized:
						<ul>
							<li><b>hazelStop</b>: If set to <i>true</i>, instructs Hazel to stop processing. Subsequent actions for this rule will not get run and the rule as a whole will be considered to have run successfully. You can use this to stop a rule from continuing based on what button a user presses in a dialog, for instance. Hazel will not re-try running this rule.</li>
							<li><b>hazelSwitchFile</b>: If set to a valid file, Hazel will apply subsequent actions to this file. You can use this to re-target what file Hazel is operating on, such switching to the parent folder or if the script transforms the file into a new one, you can point this at the new file.</li>
			                            <li><b> hazelOutputAttributes </b>:  A list of values for the custom attributes that this script exports. The values must be in the order as you specify in the interface. See the section below on <a href="#customtokens">Custom Attributes</a>.</li>

						</ul></li>
					<li>If anything besides a record is returned, that value is ignored.</li>
				</ul>
				
                <div id="asindent">
				<br/>
				<h3>For embedded scripts</h3>
				<p>You can enter AppleScript directly into Hazel as an embedded script. Scripts entered in this fashion are saved with your rules. This means that they are carried with your rules when you transfer your rules around (via export/import).</p>
				<p>To show the script editor, click on the "Edit Script" button. Here, you can enter your AppleScript. Note that no handler is needed. You can include the body of your script directly in the editor. The variable <i>theFile</i> carries an alias to the file that Hazel will pass to the script.</p>
                </div>
                
                <div id="asindent">
				<br/>
				<h3>For external scripts</h3>
				<p>For external scripts, Hazel requires that the script contain a handler called <i>hazelProcessFile</i>. The handler takes two arguments which are an alias for the file that matched the rule and a list of input attribute values (see <a href="#customtokens">Input Attributes</a>. Below is a template you can use:</p>
				<div summary="AppleScript Template" id="taskbox">
					<pre>
on hazelProcessFile(theFile, inputAttributes)

	-- Add your logic here.
	-- 'theFile' is an alias to the file that matched.
	-- 'inputAttributes' is an AppleScript list of the values of any attributes you told Hazel to pass in.
	-- Make sure to throw errors if you do not want Hazel
	--   to consider this action to have run successfully.

end hazelProcessFile
					</pre>
				</div>
                </div>

		<a name="AppleScriptInputAttributes"></a>                
                <br/>

		<h3>Input Attributes</h3>
		<p>Scripts take in a list of input attribute values as its second argument.</p>
		<p>To specify these attributes, click on the Info button: <img src="../gfx/optionsbutton.png" /> in the AppleScript condition or action.</p>
 		<p>There, on the right side, you can specify which attributes to pass into your script.</p>
		<p>Most of the built-in attributes, as well as Spotlight attributes, are available here. Any custom attributes that are defined before the condition or action are also available.</p>
		<p>When your AppleScript is run, Hazel will pass in the values for those attributes into your script as a list. They will appear in the order specified.</p>

		<br/>

                <a name="customtokens"></a>
                <h3>Custom Attributes</h3>
                <p>When writing a script, you can export custom attributes. These attributes can then be made available for any patterns for actions that come afterwards. Also, if the script is used in a condition, the resulting custom attribute can be used in subsequent conditions just like built-in attributes.
</p>
                <p>To export your attributes, just return a list in a record as described <a href="#returnrecord">above</a>.</p>
                <p>To make these attributes accessible to your rule, click on the Info button: <img src="../gfx/optionsbutton.png" />.</p>
                <p>There, on the right side, you can add the names of any attributes your script exports.  The order of the values you return in the script should match the order of the attributes you define here. These values will then be substituted wherever the attribute is used. Note that you cannot use a custom attribute before it is defined so make sure the AppleScript condition/action appears before any condition/action that will use those tokens.</p>

				<h2 class="seealso">See also</h2>
				<p class="seealso">
					<a href="writingJavaScript.html">Writing JavaScript</a><br/>
			                <a href="editingMatchPatterns.html#customtokens">Custom Tokens (Pattern Matching)</a><br/>
					<a href="ruleReference.html">Rule Reference</a><br/>
					<a href="help:topic_list=rules bookID=Hazel Help template=css/genlist.html stylesheet=css/genlist_style.css Other=Rule Topics">Rule Topics</a>
				</p>

			</div>
		</body>
		</html>
